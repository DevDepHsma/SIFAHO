<%= simple_form_for @permission_request, url: create_permission_requests_path do |f| %>
  <%= f.error_notification %>
  <%= f.input :establishment_id,
    as: :select,
    label: '¿A cuál establecimiento pertenece?',
    include_blank: false,
    collection: @establishments.map {|establishment|  [establishment.name, establishment.id]} + [["Otro...", -1]],
    :input_html => {
      placeholder: 'Seleccionar establecimiento',
      required: true,
      class: 'selectpicker custom-select-pick',
      "title"=>"Seleccionar establecimiento",
      "data-width"=>"100%",
      "data-size"=>"10",
      "data-live-search"=>true,
      "data-none-results-text" => "No se encontró el establecimiento",
      "data-request-url" => request_sectors_permission_requests_path,
      value: f.object.establishment_id.present? ? f.object.establishment_id : ""
    }
  %>
  <div id="sector-selector">
    <% if @sectors.present? %>
      <%= render('permission_requests/partials/sector_select') %>
    <% elsif @permission_request.establishment_id.present? %>
      <%= render(partial: 'permission_requests/partials/establishment_and_sector_inputs') %>
    <% end %>
  </div>

  <legend class="col-form-label pt-0">¿Qué funciones requiere?</legend>
  <% @roles.map do |role| %>
    <div class="custom-control custom-checkbox mb-1">
      <input type="checkbox" 
              class="custom-control-input <%= "is-invalid" if f.object.errors[:roles].any?  %>" 
              value="<%= role.id %>" 
              name="permission_request[role_ids][]" 
              id="permission_request_role_ids_<%= role.id %>"
              <%= 'checked' if f.object.roles.present? && f.object.roles.any? { |rol| rol.id == role.id }%>>
      <label class="custom-control-label" for="permission_request_role_ids_<%= role.id %>"><%= role.name %></label>
    </div>
  <% end %>

  <% if f.object.errors[:roles].any?  %>
    <div class="invalid-feedback d-block">Debe seleccionar una función</div>
  <% end %>

  <div class="form-inputs">
    <%= f.input :observation, label: "Observaciones" %>
  </div>
<% end %>
