<tr class="nested-fields <%= f.object.errors.any? ? 'has-error' : '' %>" id="parent-<%= f.object.product.present? ? f.object.product.id : '' %>">
  <!-- Código del producto -->
  <td>
    <% if policy(f.object).edit_parent_product? %>
      <div class="custom-input-group">
        <div class="form-group fake optional products_product_id_fake">
          <input type="text" 
          name="<%="product_code_fake-#{f.object.id}"%>" 
          value="<%= f.object.product.present? ? f.object.product.code : '' %>"
          class="form-control fake optional product-code order-product-inputs input-sm <%= ("is-invalid" if (f.object.errors[:product_id].any? || f.object.errors[:uniqueness_product_in_the_order].any?) ) %> <%= ("is-valid" if f.object.product_id.present? && (!f.object.errors[:product_id].any? || !f.object.errors[:uniqueness_product_in_the_order].any?) ) %>"
          data-autocomplete-source="<%= search_by_code_products_path %>"
          size="6"
          autocomplete="off" 
          placeholder="Código"
          <%= f.object.product.present? ? 'readonly="readonly"' : ''%>>
          <div class="invalid-feedback">
            <% if f.object.errors[:product_id].any? %>
              Producto <%= f.object.errors[:product_id].first %>
            <% elsif f.object.errors[:uniqueness_product_in_the_order].any? %>
              <%= f.object.errors[:uniqueness_product_in_the_order].first %>
            <% end %>
          </div>
        </div>

        <div class="with-loading">
          <%= fa_icon 'spinner', class: "fa-spin"%>
        </div>
      </div>
    <% else %>
      <%= f.input :product_code_fake, label: false, disabled: true,
        input_html: {
          value: "#{ f.object.product.code }",
          class: "product-code",
          size: 8,
        }
      %>
    <% end %>

    <%# Hidden product_id %>
    <%= f.input :product_id, :as => :hidden, :error => false, :input_html =>  { class: "product-id" },
      value: "#{ if f.object.product_id.present?; f.object.product_id; end }" %>
  </td>

  <!-- Nombre de Producto -->
  <td>
    <% if policy(f.object).edit_parent_product? %>
      <div class="custom-input-group">
        <div class="form-group fake optional products_product_id_fake">
          <input type="text" 
          name="<%="product_name_fake-#{f.object.id}"%>"
          value="<%= f.object.product.present? ? f.object.product.name : '' %>"
          class="form-control fake optional product-name order-product-inputs input-sm <%= ("is-invalid" if (f.object.errors[:product_id].any? || f.object.errors[:uniqueness_product_in_the_order].any?) ) %> <%= ("is-valid" if f.object.product_id.present? && (!f.object.errors[:product_id].any? || !f.object.errors[:uniqueness_product_in_the_order].any?) ) %>"
          data-autocomplete-source="<%= search_by_name_products_path %>"
          size="45" 
          autocomplete="off" 
          placeholder="Nombre"
          <%= f.object.product.present? ? 'readonly="readonly"' : ''%>>
          <% if f.object.errors[:product_id].first %>
            <div id="product_id_fake" class="invalid-feedback">
              Producto <%= f.object.errors[:product_id].first %>
            </div>
          <% end %>
        </div>

        <div class="with-loading">
          <%= fa_icon 'spinner', class: "fa-spin"%>
        </div>
      </div>
    <% else %>
      <%= f.input :product_name_fake, label: false, disabled: true,
        input_html: {
          value: "#{ f.object.product.name }",
          size: 30,
        }
      %>
    <% end %>
  </td>

  <!-- Unidad -->
  <td>
    <%= f.input :supply_unity_fake, label: false, disabled: true, required: false, 
      input_html: {
        class: 'product-unity input-sm order-product-inputs',
        size: 10,
        value: "#{
          if f.object.product.present?
            f.object.product.unity.name
          end
        }"
      } 
    %> 
  </td>
    
  <!-- Dosis -->
  <%# if policy(f.object).edit_request_quantity? %>
    <td style="width: 100px">
      <%= f.input :dose_quantity,
        label: false,
        placeholder: 'Cant',
        required: false,
        readonly: !f.object.new_record?,
        input_html: {
          "data-tooltip"=>true,
          :class=>"dose-quantity input-sm order-product-inputs",
          :title=>"Cantidad solicitada",
          "data-placement"=>"right",
          min: '1', 
          step:'any',
          :style => 'width: 100px',
          value: f.object.dose_quantity.present? ?  f.object.dose_quantity : 0
        }
      %>
    </td>
  <%# end %>

  <!-- Intervalo -->
  <td>
    <%= f.input :interval, label: false, 
      readonly: !f.object.new_record?,
      input_html: {
        class: 'input-sm dose-interval order-product-inputs',
        size: 6, 
        placeholder: "Cant",
        value: "#{ f.object.interval.present? ? f.object.interval : 0 }"
      } %>
  </td>

  <td>
    <%= f.input :total_dose, 
      label: false,
      readonly: true,
      placeholder: 'Dosis total',
      input_html: { 
        class: 'input-sm product-dose-total order-product-inputs',
        value: f.object.total_dose.present? ? f.object.total_dose : 0
      }
    %>
  </td>

  <td>
    <%= f.input :observation, label: false, as: :text,
      readonly: !f.object.new_record?,
      :input_html => { class: 'input-sm product-observartion order-product-inputs', :cols => 20  , :rows => 1 } %>
  </td>
  
  <td class="actions-col">
    <% if f.object.new_record? %>
      <!-- 
        no clickeable hasta que product_id y dose_quantity esten asignados
        controlar por js estas dos variables antes de realizar el ajax
        agregar url de guardado de producto
        agregar clase para asignarle un ajax a la url
        en la respuesta llamar al modal de lotes
      -->
      <button type="button" class="btn btn-success btn-ipp-save" data-url="<%= inpatient_prescription_inpatient_prescription_products_path(f.object.inpatient_prescription_id) %>" data-url-type="POST" data-toggle="tooltip" data-placement="top" title="Guardar" data-product-id="<%= f.object.id %>">
        <%= fa_icon 'save' %>
      </button>

      <!-- Quitar elemento (no persistido) -->
      <%= link_to_remove_association  f, class: 'remove-tag btn btn-danger',
        title: 'Quitar', data: { toggle: 'tooltip', placement: 'top' } do %>
        <%= fa_icon "trash-alt" %>
      <% end %>
       
    <% elsif policy(f.object).edit_parent_product? %>
      <%= render 'inpatient_prescriptions/partials/select_lot_stocks_btn', order: order, f_object: f.object %>
    <% end %>    
  </td>
</tr>
