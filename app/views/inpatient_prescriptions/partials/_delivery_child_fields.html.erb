<tr class="nested-fields" id="child-<%= f.object.id.present? ? f.object.product.id : '' %>">
  <!-- Código del producto -->
  <td>
    <div class="custom-input-group">
      <div class="form-group fake optional products_product_id_fake">
        <input type="text" 
        name="<%="product_code_fake"%>" 
        value="<%= f.object.product.present? ? f.object.product.code : parent.object.product.code %>"
        class="order-product-inputs form-control fake optional product-code input-sm <%= ("is-invalid" if (f.object.errors[:product_id].any? || f.object.errors[:uniqueness_product_in_the_order].any?) ) %> <%= ("is-valid" if f.object.product_id.present? && (!f.object.errors[:product_id].any? || !f.object.errors[:uniqueness_product_in_the_order].any?) ) %>"
        data-autocomplete-source="<%= search_by_code_products_path %>"
        size="6"
        autocomplete="off" 
        placeholder="Código"
        <%= f.object.id.present? ? 'readonly' : '' %>>
        <div class="invalid-feedback">
          <% if f.object.errors[:product_id].any? %>
            Producto <%= f.object.errors[:product_id].first %>
          <% elsif f.object.errors[:uniqueness_product_in_the_order].any? %>
            <%= f.object.errors[:uniqueness_product_in_the_order].first %>
          <% end %>
        </div>
      </div>

      <div class="with-loading">
        <%= fa_icon 'spinner', class: "fa-spin"%>
      </div>
    </div>

    <%# Hidden product_id %>
    <%= f.input :product_id, :as => :hidden, :error => false, :input_html =>  { class: "product-id", value: "#{ f.object.product_id.present? ? f.object.product_id : parent.object.product.id }" } %>
  </td>

  <!-- Nombre de Producto -->
  <td>
    <div class="custom-input-group">
      <div class="form-group fake optional products_product_id_fake">
        <input type="text" 
        name="<%="product_name_fake-#{f.object.id}"%>"
        value="<%= f.object.product.present? ? f.object.product.name : parent.object.product.name %>"
        class="order-product-inputs form-control fake optional product-name input-sm <%= ("is-invalid" if (f.object.errors[:product_id].any? || f.object.errors[:uniqueness_product_in_the_order].any?) ) %> <%= ("is-valid" if f.object.product_id.present? && (!f.object.errors[:product_id].any? || !f.object.errors[:uniqueness_product_in_the_order].any?) ) %>"
        data-autocomplete-source="<%= search_by_name_products_path %>"
        size="45" 
        autocomplete="off" 
        placeholder="Nombre"
        <%= f.object.id.present? ? 'readonly' : '' %>>
        <% if f.object.errors[:product_id].first %>
          <div id="product_id_fake" class="invalid-feedback">
            Producto <%= f.object.errors[:product_id].first %>
          </div>
        <% end %>
      </div>

      <div class="with-loading">
        <%= fa_icon 'spinner', class: "fa-spin"%>
      </div>
    </div>
  </td>

  <!-- Stock -->
  <td>
    <%= f.input :stock_fake, as: :fake, label: false, disabled: true, required: false, 
      input_html: {
        class: 'stock-quantity input-sm',
        size: 10,
        placeholder: "0",
        value: (f.object.product.present? ? current_user.sector.stock_to(f.object.product) : current_user.sector.stock_to(parent.object.product))
      } 
    %> 
  </td>

  <td>
    <%= f.input :dose_total, label: false, input_html: {
      class: 'order-product-inputs product-dose-total',
      readonly: f.object.id.present?,
      value: f.object.dose_total.present? ? f.object.dose_total : parent.object.dose_total
    } %>
  </td>
  
  <td>
    <%= f.input :observation, label: false, as: :text, :input_html => { 
      class: 'order-product-inputs input-sm product-observartion', 
      :cols => 20, 
      :rows => 1, 
      readonly: f.object.id.present? } %>
  </td>

  <td class="action-col">
    <% if f.object.new_record? %>
      <!-- 
        no clickeable hasta que product_id y dose_quantity esten asignados
        controlar por js estas dos variables antes de realizar el ajax
        agregar url de guardado de producto
        agregar clase para asignarle un ajax a la url
        en la respuesta llamar al modal de lotes
      -->
      <button type="button" class="btn btn-success btn-ipp-save" data-url="<%= inpatient_prescription_inpatient_prescription_products_path(order.id) %>" data-url-type="POST" data-toggle="tooltip" data-placement="top" title="Guardar" data-parent-id="<%= parent.object.id %>">
        <%= fa_icon 'save' %>
      </button>

      <%= link_to_remove_association  f, class: 'remove-tag btn btn-danger',
        title: 'Quitar', data: { toggle: 'tooltip', placement: 'top' } do %>
        <%= fa_icon "trash-alt" %>
      <% end %>
    <% else %>
      <%= render 'inpatient_prescriptions/partials/select_lot_stocks_btn', order: order, f_object: f.object%>
    <% end %>
  </td>
</tr>