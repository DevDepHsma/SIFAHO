<div class="card fixed-custom-card">
  <div class="card-header <%= @inpatient_movement.new_record? ? 'bg-primary text-white' : 'bg-warning' %> d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center ml-2">
      <%= fa_icon (@inpatient_movement.new_record? ?  "plus" : "edit")%>
      <h5 class="card-title mb-0 ml-2">
        <%= @inpatient_movement.new_record? ? "Nuevo movimiento de internaci贸n" : "Editando cama" %>
      </h5>
    </div>
    <%= link_to :back, class: @inpatient_movement.new_record? ? 'btn text-white' : 'btn' do %>
      <%= fa_icon "times" %>
    <% end %>
  </div>
  <div class="card-body panel-new-body">
    <%= simple_form_for @inpatient_movement, html: { id: 'inpatient-movement-form' } do |f| %>
      <%= f.error_notification %>
      <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

      <%# MOVEMENT TYPE %>
      <label>Tipo de movimiento</label>
      <h5><%= @inpatient_movement.movement_type.name.humanize %></h5>
      <%= f.input :movement_type_id, as: :hidden, value: @inpatient_movement.movement_type_id %>

      <%#= f.input :movement_type_id, label: 'Tipo de movimiento',
        collection: InpatientMovementType.all.map {|mov|  [mov.name.humanize, mov.id ]},
        :input_html => {
          required: true,
          include_blank: false,
          class: 'selectpicker custom-select-pick',
          "data-width"=>"100%",
          "data-size"=>"10",
          "title"=>"Seleccionar movimiento"
        }
      %>

      <%# BED %>
      <!-- If the movement is a discharge, only show the bed name -->
      <% if @inpatient_movement.movement_type_id == 2 %>
        <%= @inpatient_movement.bed_name %>
        <%= f.input :bed_id, as: :hidden, value: @inpatient_movement.bed_id %>
      <% else %>
        <div class="form-inputs">
          <%= f.input :bed_id, label: 'Cama',
            collection: Bed.establishment(current_user.sector.establishment).disponible.map {|bed|  [bed.name+"<span class='badge badge-secondary'>#{bed.bedroom_name}</span>".html_safe, bed.id,
              data: {'content': "#{bed.name} | Habitaci贸n: <span class='badge badge-secondary'>"+bed.bedroom_name+"</span>"} ]},
            :input_html => {
              required: true,
              include_blank: false,
              class: 'selectpicker custom-select-pick',
              "data-width"=>"100%",
              "data-size"=>"10",
              "title"=>"Seleccionar cama",
              "data-live-search"=>true,
              "data-none-results-text" => "No se encontr贸 el habitaci贸n"
            }
          %>
        </div>
      <% end %>

      <h4>
        <%= fa_icon 'user-injured' %> Paciente
        <%= f.input :patient_id, as: :hidden, input_html: { id: 'patient-id' } %>
      </h4>
      <hr>
        <%= simple_form_for @patient, remote: true, html: { role: 'check-modified' } do |f| %>
          <div class="form-group row">
            <label for="patient-dni" class="col-3 col-form-label">DNI:</label>
            <div class="col-9">
              <div class="custom-input-group">
                <div class="form-group string required chronic_prescription_patient">
                  <input class="form-control string required ui-autocomplete-input" 
                    id="patient-dni" 
                    data-autocomplete-source="<%= get_by_dni_patients_path %>" 
                    data-insurance-url="<%= get_insurance_path %>" 
                    name="patient[dni]"
                    value="" 
                    required="" 
                    aria-required="true" 
                    placeholder="DNI" 
                    type="text"
                    autocomplete="off"
                    data-prescriptions-url="<%= get_prescriptions_url %>"
                    autofocus>
                </div>
                <div class="with-loading">
                  <%= fa_icon 'spinner', class: "fa-spin"%>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group row">
            <label for="patient-lastname" class="col-3 col-form-label">Apellido:</label>
                
            <div class="col-9">
              <div class="form-group string required">
                <input class="form-control string required ui-autocomplete-input patient-form-input" id="patient-lastname" required aria-required="true" placeholder="Apellido" type="text" autocomplete="off" name="patient[last_name]" readonly="readonly">
              </div>
            </div>
            
          </div>
          
          <div class="form-group row">
            <label for="patient-firstname" class="col-3 col-form-label">Nombre:</label>
                
            <div class="col-9">
              <div class="form-group string required">
                <input class="form-control string required ui-autocomplete-input patient-form-input" id="patient-firstname" required aria-required="true" placeholder="Nombre" type="text" autocomplete="off" name="patient[first_name]" readonly="readonly">
              </div>
            </div>
                        
          </div>

          <div class="form-group row">
            <label for="patient-sex" class="col-3 col-form-label">Sexo:</label>
                
            <div class="col-9">
              <div class="form-group string required chronic_prescription_patient">
                <select name="patient[sex]" id="patient-sex" class="selectpicker custom-select-pick patient-form-selector d-none">
                  <% Patient.sexes.each do |sex| %>
                  <option value="<%= sex[0] %>"><%= sex[0] %></option>
                  <% end %>
                </select>
                <input class="form-control string patient-form-input" id="patient-sex-fake"  type="text" autocomplete="off" name="patient-sex-fake" readonly="readonly" value="Otro">
              </div>
            </div>
          </div>
          <input id="patient-status" name="patient[status]" type="hidden">
          <%# campos de paciente con datos de Andes %>
          <input id="patient-birthdate" class="andes-input" name="patient[birthdate]" type="hidden">
          <input id="patient-marital-status" class="andes-input" name="patient[marital_status]" type="hidden">
          
          <div id="patient-phones"></div>

          <input id="patient-email" class="andes-input" name="patient[email]" type="hidden">
          <input id="patient-postal-code" class="andes-input" name="patient[address][postal_code]" type="hidden">
          <input id="patient-line" class="andes-input" name="patient[address][line]" type="hidden">
          <input id="patient-city-name" class="andes-input" name="patient[address][city_name]" type="hidden">
          <input id="patient-state-name" class="andes-input" name="patient[address][state_name]" type="hidden">
          <input id="patient-country-name" class="andes-input" name="patient[address][country_name]" type="hidden">
          <input id="patient-andes-id" class="andes-input" name="patient[andes_id]" type="hidden">
          <input id="patient-andes-photo" class="andes-input" name="patient[photo_andes_id]" type="hidden">


        <% end %>
      <hr>
    <% end %>
  </div>
  <div class="card-footer d-flex justify-content-end">
    <%= link_to 'Volver', beds_path, class: 'btn mr-2' %>
    <button type='submit' name='commit' class='btn btn-primary' form='inpatient-movement-form'>
      <%= fa_icon "check" %> Crear
    </button>
  </div>
</div>