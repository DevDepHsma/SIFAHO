<%= simple_form_for order_product, 
                    :url => (order_product.new_record? ? external_orders_applicant_products_path(order) : external_orders_applicant_product_path(order, order_product)),
                    remote: true,
                    html: { 
                      id: "ord-prod-#{@form_id}",
                      role: 'check-modified'} do |form| %>
  <div class="row nested-fields m-0">
    <!-- C贸digo del producto -->
    <div class="col-1 pl-1 pr-1">
      <% if policy(form.object).edit_product? %>
        <div class="custom-input-group">
          <div class="form-group fake optional products_product_id_fake">
            <input type="text" 
            name="<%="product_code_fake-#{form.object.id}"%>" 
            value="<%= form.object.product.present? ? form.object.product.code : '' %>"
            class="form-control fake optional product-code input-sm <%= ("is-invalid" if (form.object.errors[:product_id].any? || form.object.errors[:uniqueness_product_in_the_order].any?) ) %> <%= ("is-valid" if form.object.product_id.present? && (!form.object.errors[:product_id].any? || !form.object.errors[:uniqueness_product_in_the_order].any?) ) %>"
            data-autocomplete-source="<%= search_by_code_products_path %>"
            size="6"
            autocomplete="off" 
            placeholder="C贸digo">
            <div class="invalid-feedback">
              <% if form.object.errors[:product_id].any? %>
                Producto <%= form.object.errors[:product_id].first %>
              <% elsif form.object.errors[:uniqueness_product_in_the_order].any? %>
                <%= form.object.errors[:uniqueness_product_in_the_order].first %>
              <% end %>
            </div>
          </div>

          <div class="with-loading">
            <%= fa_icon 'spinner', class: "fa-spin"%>
          </div>
        </div>
      <% else %>
        <%= form.input :product_code_fake, label: false, disabled: true,
          input_html: {
            value: "#{ form.object.product.code }",
            class: "product-code",
            size: 8,
          }
        %>
      <% end %>

      <%# Hidden product_id %>
      <input type="hidden" 
             class="product-id"
             name="order_product[product_id]"
             value="<%= "#{ if form.object.product_id.present?; form.object.product_id; end }" %>">
      
      <%# Hidden order_id %>
      <input type="hidden"
             name="order_product[order_id]"
             value="<%= "#{ if form.object.order_id.present?; form.object.order_id; end }" %>">
    </div>

    <!-- Nombre de Producto -->
    <div class="col pl-1 pr-1">
      <% if policy(form.object).edit_product? %>
        <div class="custom-input-group">
          <div class="form-group fake optional products_product_id_fake">
            <input type="text" 
            name="<%="product_name_fake-#{form.object.id}"%>"
            value="<%= form.object.product.present? ? form.object.product.name : '' %>"
            class="form-control fake optional product-name input-sm <%= ("is-invalid" if (form.object.errors[:product_id].any? || form.object.errors[:uniqueness_product_in_the_order].any?) ) %> <%= ("is-valid" if form.object.product_id.present? && (!form.object.errors[:product_id].any? || !form.object.errors[:uniqueness_product_in_the_order].any?) ) %>"
            data-autocomplete-source="<%= search_by_name_products_path %>"
            size="45" 
            autocomplete="off" 
            placeholder="Nombre">
            <% if form.object.errors[:product_id].first %>
              <div id="product_id_fake" class="invalid-feedback">
                Producto <%= form.object.errors[:product_id].first %>
              </div>
            <% end %>
          </div>

          <div class="with-loading">
            <%= fa_icon 'spinner', class: "fa-spin"%>
          </div>
        </div>
      <% else %>
        <%= form.input :product_name_fake, label: false, disabled: true,
          input_html: {
            value: "#{ form.object.product.name }",
            size: 30,
          }
        %>
      <% end %>
    </div>

    <!-- Unidad -->
    <div class="col-1 pl-1 pr-1">
      <%= form.input :supply_unity_fake, label: false, disabled: true, required: false, 
        input_html: {
          class: 'product-unity input-sm',
          size: 10,
          placeholder: "Unidad",
          value: "#{
            if form.object.product.present?
              form.object.product.unity.name
            end
          }"
        } 
      %> 
    </div>

    <!-- Stock -->
    <div class="col-1 pl-1 pr-1">
      <%= form.input :stock_fake, label: false, disabled: true, 
        input_html: {
          class: 'stock-quantity input-sm',
          size: 6, 
          placeholder: "Cant",
          value: "#{ form.object.product.present? ? current_user.sector.stock_to(form.object.product) : 0 }"
        } %>
    </div>
      
    <!-- Cantidad solicitada -->
    <% if policy(form.object).edit_request_quantity? %>
      <div class="col-1 pl-1 pr-1">
        <div class="form-group integer optional order_product_request_quantity">
          <input class="form-control numeric integer optional request-quantity input-sm" 
                  data-tooltip="true"
                  title="Cantidad solicitada"
                  data-placement="right"
                  min="1"
                  step="any"
                  value="0"
                  placeholder="Cant"
                  type="number"
                  name="order_product[request_quantity]"
                  id="order_product_request_quantity">
        </div>
      </div>
    <% else %>
      <div class="col-1 pl-1 pr-1">
        <%= form.input :request_quantity_fake, label: false, disabled: true,
          input_html: {
            class: "request-quantity input-sm",
            value: "#{ form.object.request_quantity }",
            size: 6
          }
        %>
      </div>
    <% end %>

    <!-- Observaciones proveedor -->
    <div class="col-3 pl-1 pr-1">
      <div class="form-group text optional order_product_applicant_observation">
        <textarea class="form-control text optional input-sm" 
                  cols="20"
                  rows="1"
                  name="order_product[applicant_observation]"
                  id="order_product_applicant_observation"></textarea>
      </div>
    </div>
    
    <!-- Botones de accion -->
    <div class="col-1 pl-1 pr-1 text-right">
      <button class="btn btn-md btn-success" type="submit" form="<%= "ord-prod-#{@form_id}" %>">
        <%= fa_icon "save" %>
      </button>
      <!-- Mostrar bot贸n de quitar  -->
      <%# if form.object.is_provision? || form.object.new_record? %>
      <%# if policy(form.object).remove_association? %>
        <!-- Bot贸n quitar -->
        <%= link_to_remove_association  form, class: 'remove-tag btn btn-warning',
          title: 'Quitar', data: { toggle: 'tooltip', placement: 'top' } do %>
            <%= fa_icon "minus" %>
        <% end %>
      <%# end %>
    </div>
  </div>
<% end %>