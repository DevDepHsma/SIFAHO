"use strict";!function(o){"object"==typeof module&&module.exports?module.exports=o:o(Highcharts)}(function(o){var e,n,r,s,t,a;n=(e=o).defined,r=e.each,s=e.extend,t=e.seriesType,e.pick,a=e.Point,t("sankey","column",{colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:undefined,nodeFormatter:function(){return this.point.name},format:undefined,formatter:function(){return""},inside:!0},linkOpacity:.5,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.85em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} \u2192 {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,forceDL:!0,createNode:function(o){function t(o,t){return e.find(o,function(o){return o.id===t})}var n,i=t(this.nodes,o);return i||(n=this.options.nodes&&t(this.options.nodes,o),(i=(new a).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},n))).linksTo=[],i.linksFrom=[],i.formatPrefix="node",i.name=i.name||i.id,i.getSum=function(){var t=0,n=0;return r(i.linksTo,function(o){t+=o.weight}),r(i.linksFrom,function(o){n+=o.weight}),Math.max(t,n)},i.offset=function(o,t){for(var n=0,e=0;e<i[t].length;e++){if(i[t][e]===o)return n;n+=i[t][e].weight}},i.hasShape=function(){var t=0;return r(i.linksTo,function(o){o.outgoing&&t++}),!i.linksTo.length||t!==i.linksTo.length},this.nodes.push(i)),i},createNodeColumn:function(){var e=this.chart,i=[],s=this.options.nodePadding;return i.sum=function(){var t=0;return r(this,function(o){t+=o.getSum()}),t},i.offset=function(o,t){for(var n=0,e=0;e<i.length;e++){if(i[e]===o)return n;n+=i[e].getSum()*t+s}},i.top=function(o){for(var t=0,n=0;n<i.length;n++)0<n&&(t+=s),t+=i[n].getSum()*o;return(e.plotSizeY-t)/2},i},createNodeColumns:function(){var i=[];return r(this.nodes,function(o){var t,n,e=0;if(0===o.linksTo.length)o.column=0;else{for(t=0;t<o.linksTo.length;t++)(n=o.linksTo[0]).fromNode.column>e&&(e=n.fromNode.column);o.column=e+1}i[o.column]||(i[o.column]=this.createNodeColumn()),i[o.column].push(o)},this),i},pointAttribs:function(o,t){var n=this.options.linkOpacity;return t&&(n=this.options.states[t].linkOpacity||n),{fill:o.isNode?o.color:e.color(o.color).setOpacity(n).get()}},generatePoints:function(){var t={};e.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,r(this.nodes,function(o){o.linksFrom.length=0,o.linksTo.length=0}),r(this.points,function(o){n(o.from)&&(t[o.from]||(t[o.from]=this.createNode(o.from)),t[o.from].linksFrom.push(o),o.fromNode=t[o.from],o.color=o.options.color||t[o.from].color),n(o.to)&&(t[o.to]||(t[o.to]=this.createNode(o.to)),t[o.to].linksTo.push(o),o.toNode=t[o.to]),o.name=o.name||o.id},this)},translate:function(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns();var d=this.chart,f=d.inverted,n=this.options,e=0,m=n.nodeWidth,p=this.nodeColumns,g=(d.plotSizeX-m)/(p.length-1),k=(f?-g:g)*n.curveFactor,y=Infinity;r(this.nodeColumns,function(o){var t=d.plotSizeY-(o.length-1)*n.nodePadding;y=Math.min(y,t/o.sum())}),r(this.nodeColumns,function(n){r(n,function(l){var o=l.getSum(),t=o*y,u=n.top(y)+n.offset(l,y),c=f?d.plotSizeX-e:e;l.sum=o,l.shapeType="rect",l.shapeArgs=f?{x:c-m,y:d.plotSizeY-u-t,width:m,height:t}:{x:c,y:u,width:m,height:t},l.shapeArgs.display=l.hasShape()?"":"none",l.plotY=1,r(l.linksFrom,function(o){var t=o.weight*y,n=l.offset(o,"linksFrom")*y,e=u+n,i=o.toNode,s=p[i.column].top(y)+i.offset(o,"linksTo")*y+p[i.column].offset(i,y),r=m,a=i.column*g,h=o.outgoing;f&&(e=d.plotSizeY-e,s=d.plotSizeY-s,a=d.plotSizeX-a,r=-r,t=-t),o.shapeType="path",o.shapeArgs={d:["M",c+r,e,"C",c+r+k,e,a-k,s,a,s,"L",a+(h?r:0),s+t/2,"L",a,s+t,"C",a-k,s+t,c+r+k,e+t,c+r,e+t,"z"]},o.dlBox={x:c+(a-c+r)/2,y:e+(s-e)/2,height:t,width:0},o.y=o.plotY=1,o.color||(o.color=l.color)})}),e+=g},this)},render:function(){var o=this.points;this.points=this.points.concat(this.nodes),e.seriesTypes.column.prototype.render.call(this),this.points=o},animate:e.Series.prototype.animate},{getClassName:function(){return"highcharts-link "+a.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})});